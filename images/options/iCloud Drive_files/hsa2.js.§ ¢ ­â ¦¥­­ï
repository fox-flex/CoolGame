(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{504:function(e,t){e.exports="jstache_1170263626"},505:function(e,t){e.exports="jstache_1136952119"},506:function(e,t){e.exports="jstache_1551731329"},507:function(e,t){e.exports="jstache_934791935"},954:function(e,t,o){e.exports=o(959)},959:function(e,t,o){"use strict";o.r(t);var r=o(4),n=o.n(r),i=(o(10),o(45),o(77),o(459),o(118),o(2)),a=o.n(i),s=o(41),l=o(7),c=(o(8),o(76),o(0)),d=function(){};(d.prototype=new l.a).constructor=d,d.prototype.verifyPhone=function(e,t,o){var r={};return r.url=c.a.urlContext+"/auth/verify/phone/securitycode"+c.a.referrerQuery,r.data=JSON.stringify({phoneNumber:{id:e},securityCode:{code:t},mode:o}),r.headers={Accept:"application/json"},this.post(r)},d.prototype.verifyDevice=function(e){var t={};return t.data=JSON.stringify({securityCode:{code:e}}),t.url=c.a.urlContext+"/auth/verify/trusteddevice/securitycode"+c.a.referrerQuery,t.headers={Accept:"application/json"},this.post(t)},d.prototype.sendNewCode=function(e,t){var o={url:c.a.urlContext+"/auth/verify/phone",data:JSON.stringify({phoneNumber:{id:e},mode:t}),headers:{Accept:"application/json"}};return this.put(o)};var u=new d,h=o(27),p=o(3),g=o(103),f=o(69),v=o(13),w=o(504),m=o.n(w),M=o(19);function b(e,t,o,r,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void o(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var y=function(e,t){var o=null;return 1===t.length?o=t[0]:n.a.each(t,(function(t,r){t.id==e&&(o=t)})),o},S=function(e,t){n.a.each(e.phones,(function(o,r){o.id!==e.selectedPhone.id&&o.attr("disable",t)}))},C=function(e,t){var o=a()("phones"),r=Object(v.a)(e.responseJSON,p.a.getString("fallback"));switch(e.status){case 400:t.attr("errorMessage",r.message);break;case 409:o.trigger("next_409",[e]);break;case 423:r.status.isTooManyCodesSent&&t.attr("lastCodeSentTo.errorMessage",p.a.getString("tooManyCodesSent")),(r.status.isTooManyCodesValidated||r.status.isSecurityCodeLocked)&&t.attr("lastCodeSentTo.errorMessage",p.a.getString("securityCodeLocked")),o.trigger("phoneSelected",[e,t.attr("lastCodeSentTo")]);break;default:t.attr("errorMessage",r.message)}},O=(n.a.Component.extend({tag:"phones",template:n.a.view(m.a),viewModel:{define:{appleIdLinkTarget:{type:"string",value:function(){return c.a.appleIdLinkTarget}},recoveryNotAvailableLink:{type:"boolean",get:function(){return!(!this.attr("twoFactorVerificationSupportUrl")||this.attr("recoveryAvailable"))}}},mode:Object(s.a)(c.a,"envConfigFromConsumer.authUIMode"),twoFactorVerificationSupportUrl:"",recoveryAvailable:!0,phones:{},lastCodeSentTo:null,isSendCodeLocked:!1,errorMessage:"",verifyMode:"",suppressIforgot:null,selectedPhone:null,showHelpDialog:!1,dialog:{moreVerificationOptions:{links:{learnHow:c.a.urlBag.verificationCodeHelp,recovery:"#",disclaimer:c.a.urlBag.accountRecoveryHelp},title:p.a.getString("verifyDeviceShowHelpDialogTitle"),titleAlign:"center",bodyAlign:"left",showAppleLogo:!1,theme:"translucent",btnOpts:{btnList:[{btnText:p.a.getString("okText"),isDisabled:!1,isPrimaryButton:!0,id:"ok-text-".concat(Object(M.a)())}],direction:"center"}},noIforgotOptions:{title:p.a.getString("noIforgotHelpDialogTitle"),titleAlign:"center",bodyAlign:"left",showAppleLogo:!1,theme:"translucent",btnOpts:{btnList:[{btnText:p.a.getString("okText"),isDisabled:!1,isPrimaryButton:!0,id:"ok-text-".concat(Object(M.a)())}],direction:"center"}}},dialogClick:function(){this.attr("showHelpDialog",!1),this.attr("showNoIforgotHelpDialog",!1)},accRecoveryClick:function(e){var t,o=this;return(t=regeneratorRuntime.mark((function t(){var r,n,i,a,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o,t.prev=1,t.next=4,g.a.getRedirectUrl("/auth/account/recovery");case 4:n=t.sent,i=Object(s.a)(n,"jqXHR",{}),"string"==typeof(a=i.getResponseHeader("Location"))&&""!==a.trim()?(l={redirectURL:a,returnUrl:Object(s.a)(c.a,"envConfigFromConsumer.returnUrl","#"),refererUrl:Object(s.a)(c.a,"refererUrl","#"),destinationDomain:Object(s.a)(c.a,"envConfigFromConsumer.returnUrl","#")},Object(s.a)(c.a,"envConfigFromConsumer.requestorContext",void 0)&&(l.requestorContext=c.a.envConfigFromConsumer.requestorContext),d=Object(f.a)(l),r.attr("dialog.moreVerificationOptions.links.recovery",d),e.target.href=d):e.preventDefault(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),C(Object(s.a)(t.t0,"jqXHR",{}),r),e.preventDefault();case 14:r.attr("showNoIforgotHelpDialog",!1),r.attr("dialog.moreVerificationOptions.links.recovery","#");case 16:case"end":return t.stop()}}),t,null,[[1,10]])})),function(){var e=this,o=arguments;return new Promise((function(r,n){var i=t.apply(e,o);function a(e){b(i,r,n,a,s,"next",e)}function s(e){b(i,r,n,a,s,"throw",e)}a(void 0)}))})()},suppressIforgotDialog:function(){this.attr("showAlternateOptions",!1),this.attr("showNoIforgotHelpDialog",!0)},recoveryNotAvailableClick:function(){this.attr("showHelpDialog",!0)}},events:{inserted:function(e,t){var o,r;this.viewModel.attr("phones",c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers),this.spinner=h.a,o=this.viewModel.phones,r=function(e){-1!==c.a.twoSV.supportedPushModes.indexOf(e.pushMode)&&("voice"===e.pushMode?e.attr("lastUsedPushModeText",p.a.getString("voiceCall")):"sms"===e.pushMode&&e.attr("lastUsedPushModeText",p.a.getString("textMsg")))},1===o.length?r(o[0]):n.a.each(o,(function(e,t){r(o[t])})),e.find("[tabindex=-1]")&&a()(e.find("[tabindex=-1]")[0]).focus()},".si-phone-row mouseup":function(e,t){if(1===t.which){this.viewModel.attr("selectedPhone",y(e.attr("phone-id"),this.viewModel.phones)),this.viewModel.selectedPhone.attr("selected",!0)}},".si-phone-row click":function(e,t){var o=this;setTimeout((function(){o.viewModel.attr("hideChev",!0),o.viewModel.selectedPhone.attr("selected",!1),o.spinner.start(a()(".arrow[data-id="+o.viewModel.selectedPhone.id+"]")),S(o.viewModel,!0),u.sendNewCode(o.viewModel.selectedPhone.id,o.viewModel.selectedPhone.pushMode).done((function(e,t,r){o.element.trigger("phoneSelected",[e])})).fail((function(e){423===e.status&&(o.viewModel.attr("lastCodeSentTo",o.viewModel.phones[0]),o.viewModel.attr("lastCodeSentTo.tooManyCodesSentLockObject",e.responseJSON)),C(e,o.viewModel)})).always((function(e,t,r){S(o.viewModel,!1),o.viewModel.attr("hideChev",!1),o.spinner.stop()}))}),200)},".error click":function(e,t){this.viewModel.attr("errorMessage","")},'[role="button"] focus':function(e,t){this.viewModel.attr("selectedPhone",y(e.attr("phone-id"),this.viewModel.phones))},"{viewModel} errorMessage":function(){if(this.viewModel.errorMessage){var e=this;setTimeout((function(){a()(".error",e.element).focus()}),1e3)}}}}),o(132),o(131),o(133),o(105)),T=o(33),P=o(140),k=o(505),N=o.n(k),x=o(16),D=o(84);function A(e,t,o,r,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void o(e)}s.done?t(l):Promise.resolve(l).then(r,n)}function j(e){return function(){var t=this,o=arguments;return new Promise((function(r,n){var i=e.apply(t,o);function a(e){A(i,r,n,a,s,"next",e)}function s(e){A(i,r,n,a,s,"throw",e)}a(void 0)}))}}var H=425,V=412,F=function(e){e.element.find(".char-field").val(""),e.viewModel.attr("verifyCode",""),e.element.find(".char-field").first().focus()},L=function(e,t){var o=a()("verify-phone"),r=Object(v.a)(e.responseJSON,p.a.getString("fallback"));switch(e.status){case 400:Object(D.a)(r.code)?a()("hsa2").trigger("authFailed",r):t.attr("errorMessage",r.message);break;case 409:o.trigger("next_409",[e]);break;case 423:r.status.isTooManyCodesSent&&(t.attr("errorMessage",p.a.getString("tooManyCodesSent")),t.attr("tooManyCodesSent",!0)),(r.status.isTooManyCodesValidated||r.status.isSecurityCodeLocked)&&t.attr("errorMessage",p.a.getString("securityCodeLocked"));break;case 412:if(!e.getResponseHeader("location")){t.attr("errorMessage",Object(p.b)("web.error.unknown.description"));break}o.trigger("repairAppleID",[e]),t.attr("isRepair",!0);break;default:t.attr("errorMessage",r.message)}},I=(n.a.Component.extend({tag:"verify-phone",template:n.a.view(N.a),viewModel:{define:{supportPin:{type:"object",value:function(){return{}}},authType:{type:"string",get:function(){return Object(s.a)(c.a,"authType")}},btnList:{type:"object",value:function(){var e=this;return{supportPin:{isDisabled:!1,btnText:p.a.getString("supportPinBtnText"),clickHandler:function(){e.attr("dialogType","generatePinDialog")}}}}},appleIdLinkTarget:{type:"string",value:function(){return c.a.appleIdLinkTarget}},recoveryNotAvailableLink:{type:"boolean",get:function(){return!(!this.attr("twoFactorVerificationSupportUrl")||this.attr("recoveryAvailable"))}},showMoreInformationDialog:{type:"boolean",value:!1}},dialogType:"verification",generatePinClickHandler:function(){var e=this;return j(regeneratorRuntime.mark((function t(){var o,r,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e,r="",n="",t.prev=1,o.attr("showSpinner","true"),t.next=5,P.a.getPin();case 5:i=t.sent,o.supportPin.attr("PIN",i.data.pin),r=i.data.date,n=p.a.getString("web.date.time.format.LT"),o.supportPin.attr("validUntil",O.a.formatDateTime({dateTimeISOString:r,momentFormatType:n,isUTCFormat:!0})),o.attr("showSpinner","false"),o.attr("dialogType","supportPinSuccess"),t.next=20;break;case 15:t.prev=15,t.t0=t.catch(1),o.attr("showSpinner","false"),o.attr("dialogType","couldNotGenerateSupportPin");case 20:case"end":return t.stop()}}),t,null,[[1,15]])})))()},dialogClick:function(e,t){this.attr("showHelpDialog",!1),this.attr("showNoIforgotHelpDialog",!1),e===T.a.getHashCode(p.a.getString("btnTextGeneratePin").trim().toLowerCase())||e===T.a.getHashCode(p.a.getString("btnTextGenerateNewPin").trim().toLowerCase())?this.generatePinClickHandler():e===T.a.getHashCode(p.a.getString("btnTextDone").trim().toLowerCase())||e===T.a.getHashCode(p.a.getString("okText").trim().toLowerCase())?a()("hsa2").trigger("authFailed"):e===T.a.getHashCode(p.a.getString("btnTextGoBack").trim().toLowerCase())&&this.attr("dialogType","verification")},dialogClosed:function(){this.attr("isRepair")||a()("sa").trigger("authFailed")},generatePinDialog:{title:p.a.getString("titleGeneratePin"),btnOpts:{btnTexts:[p.a.getString("btnTextGoBack"),p.a.getString("btnTextGeneratePin")],direction:"center"}},generateNewPinDialog:{title:p.a.getString("titleGeneratePin"),btnOpts:{btnTexts:[p.a.getString("btnTextGenerateNewPin"),p.a.getString("btnTextDone")],direction:"center"}},couldNotGenerateSupportPinDialog:{title:p.a.getString("titleCanNotGeneratePin"),btnOpts:{btnTexts:[p.a.getString("okText")],direction:"center"}},twoFactorVerificationSupportUrl:"",mode:Object(s.a)(c.a,"envConfigFromConsumer.authUIMode"),recoveryAvailable:!0,codeSentToPhone:null,verifyCode:"",errorMessage:"",codeLength:null,usedPushMode:"",localisedDigit:p.a.getString("localisedDigit"),allow:{verifyCode:!1},showSpinnerFor:{verifyingCode:!1,sendingCode:!1,calling:!1},otherOptionsClicked:!1,showAlternateOptions:!1,showHelpDialog:!1,showNoIforgotHelpDialog:!1,isRepair:!1,dialog:{moreVerificationOptions:{links:{learnHow:c.a.urlBag.verificationCodeHelp.trim(),recovery:"#",disclaimer:c.a.urlBag.accountRecoveryHelp.trim()},title:p.a.getString("verifyDeviceShowHelpDialogTitle"),titleAlign:"center",bodyAlign:"left",showAppleLogo:!1,theme:"translucent",btnOpts:{btnList:[{btnText:p.a.getString("okText"),isDisabled:!1,isPrimaryButton:!0,id:"ok-text-".concat(Object(M.a)())}],direction:"center"}},noIforgotOptions:{title:p.a.getString("noIforgotHelpDialogTitle"),titleAlign:"center",bodyAlign:"left",showAppleLogo:!1,theme:"translucent",btnOpts:{btnList:[{btnText:p.a.getString("okText"),isDisabled:!1,isPrimaryButton:!0,id:"ok-text-".concat(Object(M.a)())}],direction:"center"}}},suppressIforgot:null,hasMoreThanOneTrustedPhoneNumbers:!1,viewportWidth:window.innerWidth<=H||window.innerHeight<=V?"small":"large",accRecoveryClick:function(e){var t=this;return j(regeneratorRuntime.mark((function o(){var r,n,i,a,l,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r=t,o.prev=1,o.next=4,g.a.getRedirectUrl("/auth/account/recovery");case 4:n=o.sent,i=Object(s.a)(n,"jqXHR",{}),"string"==typeof(a=i.getResponseHeader("Location"))&&""!==a.trim()?(l={redirectURL:a,returnUrl:Object(s.a)(c.a,"envConfigFromConsumer.returnUrl","#"),refererUrl:Object(s.a)(c.a,"refererUrl","#"),destinationDomain:Object(s.a)(c.a,"envConfigFromConsumer.returnUrl","#")},Object(s.a)(c.a,"envConfigFromConsumer.requestorContext",void 0)&&(l.requestorContext=c.a.envConfigFromConsumer.requestorContext),d=Object(f.a)(l),r.attr("dialog.moreVerificationOptions.links.recovery",d),e.target.href=d):e.preventDefault(),o.next=14;break;case 10:o.prev=10,o.t0=o.catch(1),L(Object(s.a)(o.t0,"jqXHR",{}),r),e.preventDefault();case 14:r.attr("showHelpDialog",!1),r.attr("showNoIforgotHelpDialog",!1),r.attr("showAlternateOptions",!1),r.attr("dialog.moreVerificationOptions.links.recovery","#");case 18:case"end":return o.stop()}}),o,null,[[1,10]])})))()},suppressIforgotDialog:function(){return this.attr("showAlternateOptions",!1),this.attr("showNoIforgotHelpDialog",!0),!1},recoveryNotAvailableClick:function(){return this.attr("showAlternateOptions",!1),this.attr("showHelpDialog",!0),!1},moreInformationClick:function(e){e.preventDefault(),this.attr("showMoreInformationDialog",!0)}},events:{inserted:function(e,t){this.spinner=h.a;var o=this.viewModel;if(o.lastCodeSentToPhone&&""!==o.lastCodeSentToPhone.errorMessage)o.attr("errorMessage",o.lastCodeSentToPhone.errorMessage),o.attr("codeSentToPhoneNumber","restricted"===o.attr("authType")?o.lastCodeSentToPhone.numberWithDialCode:o.lastCodeSentToPhone.obfuscatedNumber),o.attr("usedPushMode",o.lastCodeSentToPhone.pushMode),o.attr("codeLength",6),o.codeSentToPhone&&o.codeSentToPhone.securityCode&&o.codeSentToPhone.securityCode.tooManyCodesSent&&o.attr("tooManyCodesSent",o.codeSentToPhone.securityCode.tooManyCodesSent);else if(o.codeSentToPhone&&o.codeSentToPhone.securityCode){var r=o.codeSentToPhone.serviceErrors||o.codeSentToPhone.service_errors||o.codeSentToPhone.validationErrors;void 0!==r&&(r.length>0?(o.attr("errorMessage",r[0].message),o.codeSentToPhone.securityCode.tooManyCodesSent&&o.attr("tooManyCodesSent",!0)):o.attr("errorMessage",p.a.getString("fallback"))),o.attr("codeSentToPhoneNumber","restricted"===o.attr("authType")?o.codeSentToPhone.phoneNumber.numberWithDialCode:o.codeSentToPhone.phoneNumber.obfuscatedNumber),o.attr("usedPushMode",o.codeSentToPhone.phoneNumber.pushMode),o.codeSentToPhone.securityCode.length&&""!==o.codeSentToPhone.securityCode.length?o.attr("codeLength",o.codeSentToPhone.securityCode.length):o.attr("codeLength",6)}o.attr("hasMoreThanOneTrustedPhoneNumbers",c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers.length>1)}," keyup":function(e,t){27===t.which&&(this.viewModel.showAlternateOptions||this.viewModel.attr("showMoreInformationDialog"))&&(this.viewModel.attr("showAlternateOptions",!1),this.viewModel.attr("showMoreInformationDialog",!1),this.viewModel.otherOptionsClicked&&this.viewModel.attr("otherOptionsClicked",!1))},"security-code completed":function(e,t,o){var r;Object(x.e)(["authSecondFactor"]),this.viewModel.attr("verifyCode",o),(r=this).viewModel.attr("errorMessage",""),r.viewModel.attr("showSpinnerFor.verifyingCode",!0),Object(x.e)(["authSecondFactor","verifyPhoneCalled"]),r.viewModel.tooManyCodesSent&&r.viewModel.lastCodeSentToPhone?u.verifyPhone(r.viewModel.lastCodeSentToPhone.id,r.viewModel.verifyCode,r.viewModel.lastCodeSentToPhone.tooManyCodesSentLockObject.mode).done((function(e,t,o){Object(x.d)(["authSecondFactor","verifyPhoneCalled"]),r.element.trigger("authCompleted",[o])})).fail((function(e,t,o){F(r),r.viewModel.attr("showSpinnerFor.verifyingCode",!1),L(e,r.viewModel)})):u.verifyPhone(r.viewModel.codeSentToPhone.phoneNumber.id,r.viewModel.verifyCode,r.viewModel.codeSentToPhone.phoneNumber.pushMode).done((function(e,t,o){Object(x.d)(["endAuthSecondFactor","verifyPhoneCalled"]),r.element.trigger("authCompleted",[o])})).fail((function(e,t,o){F(r),r.viewModel.attr("showSpinnerFor.verifyingCode",!1),L(e,r.viewModel)}))},".char-field keypress":function(e,t){this.viewModel.attr("errorMessage","")},"#didnt-get-code click":function(e,t){return this.viewModel.attr("showAlternateOptions",!this.viewModel.showAlternateOptions),this.viewModel.attr("showMoreInformationDialog",!1),!1},"#use-diff-ph click":function(e,t){return this.element.trigger("usePhone"),!1},"#other-opts click":function(e,t){return this.viewModel.attr("otherOptionsClicked",!this.viewModel.otherOptionsClicked),this.viewModel.attr("showAlternateOptions",!this.viewModel.showAlternateOptions),!1},".error click":function(e,t){this.viewModel.attr("errorMessage","")},"#try-again click":function(e,t){var o=this;return o.viewModel.attr("errorMessage",""),setTimeout((function(){o.viewModel.attr("showSpinnerFor.calling",!0),u.sendNewCode(o.viewModel.codeSentToPhone.phoneNumber.id,o.viewModel.codeSentToPhone.phoneNumber.pushMode).done((function(e,t,o){})).fail((function(e){L(e,o.viewModel)})).always((function(e,t,r){o.viewModel.attr("showSpinnerFor.calling",!1),o.viewModel.attr("showAlternateOptions",!1),o.viewModel.attr("showMoreInformationDialog",!1)}))}),300),!1},"#call-me click":function(e,t){var o=this;return o.viewModel.attr("errorMessage",""),o.viewModel.attr("showAlternateOptions",!1),o.element.find(".char-field").first().focus(),setTimeout((function(){o.viewModel.attr("showSpinnerFor.sendingCode",!0),u.sendNewCode(o.viewModel.codeSentToPhone.phoneNumber.id,"voice").done((function(e,t,r){o.viewModel.attr("codeSentToPhone",e),o.viewModel.attr("usedPushMode","voice")})).fail((function(e){L(e,o.viewModel)})).always((function(e,t,r){o.viewModel.attr("showSpinnerFor.sendingCode",!1)}))}),300),!1},"#sms-me click":function(e,t){var o=this;return o.viewModel.attr("errorMessage",""),o.viewModel.attr("showAlternateOptions",!1),o.element.find(".char-field").first().focus(),setTimeout((function(){o.viewModel.attr("showSpinnerFor.sendingCode",!0),u.sendNewCode(o.viewModel.codeSentToPhone.phoneNumber.id,"sms").done((function(e,t,r){o.viewModel.attr("codeSentToPhone",e),o.viewModel.attr("usedPushMode","sms")})).fail((function(e){L(e,o.viewModel)})).always((function(e,t,r){o.viewModel.attr("showSpinnerFor.sendingCode",!1)}))}),300),!1},"idms-modal modalClose":function(e,t){this.viewModel.attr("showHelpDialog",!1),this.viewModel.attr("showNoIforgotHelpDialog",!1),this.viewModel.attr("showMoreInformationDialog",!1)},"{scope} showSpinnerFor.verifyingCode":function(e,t,o){o?this.spinner.start(a()("#verifying-code"),"small"):this.spinner.stop()},"{scope} showAlternateOptions":function(e,t,o,r){o||this.viewModel.attr("otherOptionsClicked",!1)},"{scope} showSpinnerFor.sendingCode":function(e,t,o){o?this.spinner.start(a()("#sending-code"),"small"):this.spinner.stop()}}}),function(){});(I.prototype=new l.a).constructor=I,I.prototype.pushAuthCode=function(e){return this.put({url:c.a.urlContext+e})};var R=new I,U=o(506),B=o.n(U);function q(e,t,o,r,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void o(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var _=425,J=412,G=function(e,t){var o=a()("verify-device"),r=Object(v.a)(e.responseJSON),n=Object(v.a)(e.responseJSON,p.a.getString("fallback")).message;switch(e.status){case 400:Object(D.a)(r.code)?a()("hsa2").trigger("authFailed",r):t.attr("errorMessage",n);break;case 409:o.trigger("next_409",[e]);break;case 423:r.status.isTooManyCodesSent?t.attr("errorMessage",p.a.getString("tooManyCodesSent")):r.status.isTooManyCodesValidated||r.status.isSecurityCodeLocked?t.attr("errorMessage",p.a.getString("securityCodeLocked")):t.attr("errorMessage",r.message);break;case 412:if(!e.getResponseHeader("location")){t.attr("errorMessage",Object(p.b)("web.error.unknown.description"));break}o.trigger("repairAppleID",[e]),t.attr("isRepair",!0);break;default:t.attr("errorMessage",n)}},W=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];R.pushAuthCode("/auth/verify/trusteddevice/securitycode").fail((function(t,o,r){e.viewModel.attr("allow.resendCode",!(423===t.status)),G(t,e.viewModel)})).always((function(){e.element.find(".char-field").first().focus(),e.viewModel.attr("showAlternateOptions",t)}))},X=(n.a.Component.extend({tag:"verify-device",template:n.a.view(B.a),viewModel:{define:{appleIdLinkTarget:{type:"string",value:function(){return c.a.appleIdLinkTarget}},recoveryNotAvailableLink:{type:"boolean",get:function(){return!(!this.attr("twoFactorVerificationSupportUrl")||this.attr("recoveryAvailable"))}}},mode:Object(s.a)(c.a,"envConfigFromConsumer.authUIMode"),twoFactorVerificationSupportUrl:"",recoveryAvailable:!0,verifyCode:"",errorMessage:"",codeLength:null,allow:{verifyCode:!1,resendCode:!0,sendText:!0},suppressIforgot:null,showSpinnerFor:{verifyingCode:!1,gettingRecoveryPath:!1},showAlternateOptions:!1,localisedDigit:p.a.getString("localisedDigit"),lastUsedPushMode:"",hasOnlyOneTrustedPhoneNumber:!1,showHelpDialog:!1,isRepair:!1,dialogClick:function(){this.attr("showHelpDialog",!1),this.attr("showNoIforgotHelpDialog",!1)},dialog:{moreVerificationOptions:{links:{learnHow:c.a.urlBag.verificationCodeHelp,recovery:"#",disclaimer:c.a.urlBag.accountRecoveryHelp},title:p.a.getString("verifyDeviceShowHelpDialogTitle"),titleAlign:"center",bodyAlign:"left",showAppleLogo:!1,theme:"translucent",btnOpts:{btnList:[{btnText:p.a.getString("okText"),isDisabled:!1,isPrimaryButton:!0,id:"ok-text-".concat(Object(M.a)())}],direction:"center"}},noIforgotOptions:{title:p.a.getString("noIforgotHelpDialogTitle"),titleAlign:"center",bodyAlign:"left",showAppleLogo:!1,theme:"translucent",btnOpts:{btnList:[{btnText:p.a.getString("okText"),isDisabled:!1,isPrimaryButton:!0,id:"ok-text-".concat(Object(M.a)())}],direction:"center"}}},viewportWidth:window.innerWidth<=_||window.innerHeight<=J?"small":"large",accRecoveryClick:function(e){var t,o=this;return(t=regeneratorRuntime.mark((function t(){var r,n,i,l,d,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=o).attr("showSpinnerFor.gettingRecoveryPath",!0),t.prev=2,t.next=5,g.a.getRedirectUrl("/auth/account/recovery");case 5:n=t.sent,i=Object(s.a)(n,"jqXHR",{}),"string"==typeof(l=i.getResponseHeader("Location"))&&""!==l.trim()?(d={redirectURL:l,returnUrl:Object(s.a)(c.a,"envConfigFromConsumer.returnUrl","#"),refererUrl:Object(s.a)(c.a,"refererUrl","#"),destinationDomain:Object(s.a)(c.a,"envConfigFromConsumer.returnUrl","#")},Object(s.a)(c.a,"envConfigFromConsumer.requestorContext",void 0)&&(d.requestorContext=c.a.envConfigFromConsumer.requestorContext),u=Object(f.a)(d),r.attr("dialog.moreVerificationOptions.links.recovery",u),e.target.href=u):e.preventDefault(),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(2),G(Object(s.a)(t.t0,"jqXHR",{}),r),e.preventDefault();case 15:r.attr("showHelpDialog",!1),r.attr("showSpinnerFor.gettingRecoveryPath",!1),r.attr("showNoIforgotHelpDialog",!1),r.attr("showAlternateOptions",!1),a()("security-code").find(".char-field").first().focus(),r.attr("dialog.moreVerificationOptions.links.recovery","#");case 21:case"end":return t.stop()}}),t,null,[[2,11]])})),function(){var e=this,o=arguments;return new Promise((function(r,n){var i=t.apply(e,o);function a(e){q(i,r,n,a,s,"next",e)}function s(e){q(i,r,n,a,s,"throw",e)}a(void 0)}))})()},suppressIforgotDialog:function(){this.attr("showAlternateOptions",!1),this.attr("showNoIforgotHelpDialog",!0)},recoveryNotAvailableClick:function(){this.attr("showAlternateOptions",!1),this.attr("showHelpDialog",!0)}},events:{inserted:function(e,t){c.a.isResume2FA&&c.a.hasTrustedDevices&&W(this,!1),c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers&&this.viewModel.attr("hasOnlyOneTrustedPhoneNumber",1===c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers.length),this.spinner=h.a,this.viewModel.hasOnlyOneTrustedPhoneNumber&&this.viewModel.attr("lastUsedPushMode",c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers[0].pushMode);var o=this.viewModel;this.element.find(".char-field").first().focus(),o.attr("codeLength",6)},keyup:function(e,t){27===t.which&&this.viewModel.showAlternateOptions&&this.viewModel.attr("showAlternateOptions",!1)},"security-code completed":function(e,t,o){var r;Object(x.e)(["authSecondFactor"]),this.viewModel.attr("verifyCode",o),(r=this).viewModel.attr("errorMessage",""),r.viewModel.attr("showSpinnerFor.verifyingCode",!0),Object(x.e)(["authSecondFactor","verifyDeviceCalled"]),u.verifyDevice(r.viewModel.verifyCode).done((function(e,t,o){Object(x.d)(["authSecondFactor","verifyDeviceCalled"]),r.element.trigger("authCompleted",[o])})).fail((function(e,t,o){!function(e){e.element.find(".char-field").val(""),e.viewModel.attr("verifyCode",""),e.element.find(".char-field").first().focus()}(r),G(e,r.viewModel)})).always((function(){r.viewModel.attr("showSpinnerFor.verifyingCode",!1)}))},".char-field keyup":function(e,t){this.viewModel.attr("errorMessage","")},"#no-trstd-device-pop click":function(e,t){return this.viewModel.attr("showAlternateOptions",!this.viewModel.showAlternateOptions),this.viewModel.attr("showAlternateOptions")||this.element.find(".char-field").first().focus(),!1},"#use-phone click":function(e,t){var o=c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers,r=this;return 1===o.length?u.sendNewCode(o[0].id,o[0].pushMode).done((function(e){r.element.trigger("codeSent",[e])})).fail((function(e){r.viewModel.attr("allow.sendText",!(423===e.status)),r.viewModel.attr("showAlternateOptions",!1),G(e,r.viewModel)})).always((function(e){})):r.element.trigger("usePhone"),!1},"#try-again click":function(e,t){return W(this,!1),!1},".error click":function(e,t){this.viewModel.attr("errorMessage","")},"idms-modal modalClose":function(e,t){this.viewModel.attr("showHelpDialog",!1),this.element.find(".char-field").first().focus(),this.viewModel.attr("showNoIforgotHelpDialog",!1)},"{viewModel} showSpinnerFor.verifyingCode":function(e,t,o){o?this.spinner.start(a()("#verifying-code"),"small"):this.spinner.stop()},"{viewModel} showSpinnerFor.gettingRecoveryPath":function(e,t,o){o?this.spinner.start(a()("#getting-recovery-path")):this.spinner.stop()}}}),o(263),o(507)),E=o.n(X),K=function(e,t,o){e.attr("lastCodeSentToPhone",o),t.responseJSON?e.attr("codeSentToPhone",t.responseJSON):e.attr("codeSentToPhone",t),e.attr("section","verifyPhone")},Q=n.a.Component.extend({tag:"hsa2",template:n.a.view(E.a),viewModel:{define:{twoFactorVerificationSupportUrl:{type:"string",value:function(){return Object(s.a)(c.a,"twoSV.phoneNumberVerification.twoFactorVerificationSupportUrl","")}},recoveryAvailable:{type:"boolean",get:function(){var e=!0;return Object(s.a)(c.a,"twoSV.phoneNumberVerification.hasRecoveryKey",!1)&&!Object(s.a)(c.a,"twoSV.phoneNumberVerification.supportsRecoveryKey",!1)&&(e=!1),e}},suppressCompletionSpinner:{type:"boolean",get:function(){return"FALSE"===Object(s.a)(c.a,"envConfigFromConsumer.waitAnimationOnAuthComplete",!1).toString().trim().toUpperCase()}}},section:"",selectedPhone:null,xhr:null,suppressIforgot:!1},init:function(e,t){Object(x.e)(["loadHSA2Component"])},events:{inserted:function(){Object(x.d)(["authFirstFactor"]),"managed"===c.a.authType&&this.viewModel.attr("suppressIforgot",!0),this.element.trigger("__inserted"),c.a.hasTrustedDevices?this.viewModel.attr("section","verifyDevice"):c.a.twoSV.phoneNumberVerification&&(c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers?0===c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers.length||(1===c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers.length?K(this.viewModel,c.a.twoSV.phoneNumberVerification):c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers.length>1&&this.viewModel.attr("section","phones")):(c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers=[],c.a.twoSV.phoneNumberVerification.trustedPhoneNumbers.push(c.a.twoSV.phoneNumberVerification),K(this.viewModel,c.a.twoSV.phoneNumberVerification)))},"phones phoneSelected":function(e,t,o,r){K(this.viewModel,o,r)},"verify-phone authCompleted":function(e,t,o){c.a.is2SVTrustEligible&&!this.viewModel.attr("skipTrustBrowserStep")?(o&&this.viewModel.attr("xhr",o),this.viewModel.attr("section","trustMyBrowser")):this.element.trigger("authSuccess",o)},"verify-phone next_409":function(e,t,o){this.element.trigger("next_409",[o])},"verify-phone noTrustedPhones":function(e,t){this.viewModel.attr("section","phones")},"verify-phone usePhone":function(e,t){this.viewModel.attr("section","phones")},"verify-device codeSent":function(e,t,o){K(this.viewModel,o)},"verify-device authCompleted":function(e,t,o){c.a.is2SVTrustEligible&&!this.viewModel.attr("skipTrustBrowserStep")?(o&&this.viewModel.attr("xhr",o),this.viewModel.attr("section","trustMyBrowser")):this.element.trigger("authSuccess",o)},"verify-device usePhone":function(e,t){this.viewModel.attr("section","phones")},"verify-device next_409":function(e,t,o){this.element.trigger("next_409",[o])},"trust-browser complete":function(e,t,o){o?this.element.trigger("authSuccess",o):this.element.trigger("authSuccess",this.viewModel.xhr)}}});t.default=Q}},[[954,1,0]]]);
